<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analisis Gejala TBC - Epicare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
      body {
        background: linear-gradient(to right, #0a996a, #0e3f2c);
      }
      .glass {
        backdrop-filter: blur(12px);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="text-white min-h-screen font-sans overflow-hidden">

    <!-- Sidebar -->
    <aside class="fixed top-5 bottom-5 bg-[#01BF81] left-5 w-16 flex flex-col items-center py-6 glass z-50 shadow-lg rounded-xl">
      <div class="flex flex-col justify-between h-full items-center w-full">

        <!-- Logo -->
        <a href="#">
          <img src="./img/epicare-logo.png" alt="Logo" class="w-8 h-8" />
        </a>

        <!-- Tabs Tengah -->
        <div class="flex flex-col items-center space-y-6">
          
          <!-- Tab: Analisis Gejala -->
          <div class="relative group">
            <a href="./sistem_analisis.html"
              class="w-10 h-10 flex items-center justify-center rounded-full border-2 border-white text-white text-xl hover:scale-110 transition-all"
              title="Sistem Analisis Gejala">
              <i class="fas fa-stethoscope"></i>
            </a>
            <!-- Tooltip -->
            <div class="absolute left-12 top-1/2 transform -translate-y-1/2 bg-white text-[#01BF81] text-xs font-semibold px-3 py-1 rounded shadow opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-50">
              Sistem Analisis Gejala
            </div>
          </div>

          <!-- Tab: Chatbot -->
          <div class="relative group">
            <a href="./chatbot.html"
              class="w-10 h-10 flex items-center justify-center rounded-full border-2 border-white text-white text-xl hover:scale-110 transition-all"
              title="Chatbot">
              <i class="fas fa-robot"></i>
            </a>
            <!-- Tooltip -->
            <div class="absolute left-12 top-1/2 transform -translate-y-1/2 bg-white text-[#01BF81] text-xs font-semibold px-3 py-1 rounded shadow opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-50">
              Chatbot
            </div>
          </div>

        </div>

        <!-- Profile -->
        <a href="#"
          class="w-10 h-10 rounded-full overflow-hidden border-2 border-white hover:scale-105 transition">
          <img src="./img/profile.png" alt="Profile" class="w-full h-full object-cover" />
        </a>

      </div>
    </aside>

    <!-- Main Content -->
    <main class="ml-20 px-8 py-5 max-w-7xl mx-auto overflow-hidden">
      <section class="text-center mb-5">
        <h1 class="text-4xl font-bold tracking-wide">Analisis Gejala TBC</h1>
        <p class="text-lg mt-2 text-gray-200">Sistem deteksi dini TBC berbasis gejala menggunakan Machine Learning</p>
      </section>

      <form class="grid md:grid-cols-2 gap-8 text-center items-center">
        <!-- Card 1 -->
        <div>
          <div class="glass p-6 rounded-2xl shadow-md space-y-6">
            <!-- Q1 -->
            <div>
              <label class="block font-semibold mb-1 text-lg text-white">Q11. Apakah Anda mudah tersinggung akhir-akhir ini?</label>
              <div class="flex gap-6 text-base justify-center">
                <label><input type="radio" name="q11" value="0" class="mr-1 accent-[#0a996a]" /> Tidak/Ringan</label>
                <label><input type="radio" name="q11" value="1" class="mr-1 accent-[#0a996a]" /> Sedang</label>
                <label><input type="radio" name="q11" value="2" class="mr-1 accent-[#0a996a]" /> Parah</label>
              </div>
              <hr class="border-gray-400 mt-3" />
            </div>

            <!-- Q2 -->
            <div>
              <label class="block font-semibold mb-1 text-lg text-white">Q12. Apakah Anda kehilangan nafsu makan?</label>
              <div class="flex gap-6 text-base justify-center">
                <label><input type="radio" name="q12" value="0" class="mr-1 accent-[#0a996a]" /> Tidak/Ringan</label>
                <label><input type="radio" name="q12" value="1" class="mr-1 accent-[#0a996a]" /> Sedang</label>
                <label><input type="radio" name="q12" value="2" class="mr-1 accent-[#0a996a]" /> Parah</label>
              </div>
              <hr class="border-gray-400 mt-3" />
            </div>

            <!-- Q3 -->
            <div>
              <label class="block font-semibold mb-1 text-lg text-white">Q13. Apakah Anda merasa kekurangan energi?</label>
              <div class="flex gap-6 text-base justify-center">
                <label><input type="radio" name="q13" value="0" class="mr-1 accent-[#0a996a]" /> Tidak/Ringan</label>
                <label><input type="radio" name="q13" value="1" class="mr-1 accent-[#0a996a]" /> Sedang</label>
                <label><input type="radio" name="q13" value="2" class="mr-1 accent-[#0a996a]" /> Parah</label>
              </div>
              <hr class="border-gray-400 mt-3" />
            </div>

            <!-- Q4 -->
            <div>
              <label class="block font-semibold mb-1 text-lg text-white">Q14. Apakah Anda mengalami pembesaran kelenjar getah bening?</label>
              <div class="flex gap-6 text-base justify-center">
                <label><input type="radio" name="q14" value="0" class="mr-1 accent-[#0a996a]" /> Tidak/Ringan</label>
                <label><input type="radio" name="q14" value="1" class="mr-1 accent-[#0a996a]" /> Sedang</label>
                <label><input type="radio" name="q14" value="2" class="mr-1 accent-[#0a996a]" /> Parah</label>
              </div>
              <hr class="border-gray-400 mt-3" />
            </div>
          </div>

          <!-- Tombol Prev & Next -->
          <div class="flex justify-center gap-4 mt-6">
            <a href="./sistem_analisis.html" class="bg-[#192824] hover:bg-[#0e3f2c] transition text-white px-8 py-2 rounded-xl shadow-md text-lg border-white border-2">Prev</a>
          </div>
        </div>

        <!-- Card 2 -->
        <div>
          <div class="glass p-6 rounded-2xl shadow-md space-y-6">
            <!-- Q6 -->
            <div>
              <label class="block font-semibold mb-1 text-lg text-white">Q15. Apakah tekanan darah sistolik Anda tinggi?</label>
              <div class="flex gap-6 text-base justify-center">
                <label><input type="radio" name="q15" value="0" class="mr-1 accent-[#0a996a]" /> Tidak/Ringan</label>
                <label><input type="radio" name="q15" value="1" class="mr-1 accent-[#0a996a]" /> Sedang</label>
                <label><input type="radio" name="q15" value="2" class="mr-1 accent-[#0a996a]" /> Parah</label>
              </div>
              <hr class="border-gray-400 mt-3" />
            </div>

            <!-- Q7 -->
            <div>
              <label class="block font-semibold mb-1 text-lg text-white">Q16. Apakah berat badan Anda ideal?</label>
              <div class="flex gap-6 text-base justify-center">
                <label><input type="radio" name="q16" value="0" class="mr-1 accent-[#0a996a]" /> Tidak/Ringan</label>
                <label><input type="radio" name="q16" value="1" class="mr-1 accent-[#0a996a]" /> Sedang</label>
                <label><input type="radio" name="q16" value="2" class="mr-1 accent-[#0a996a]" /> Parah</label>
              </div>
              <hr class="border-gray-400 mt-3" />
            </div>
          </div>

          <div class="flex justify-center mt-6">
            <button type="button" id="predict-btn" class="bg-[#192824] hover:bg-[#0e3f2c] transition text-white px-8 py-2 rounded-xl shadow-md text-lg border-white border-2">Prediksi</button>
          </div>

          <!-- Output Prediksi -->
          <div id="prediction-result" class="hidden mt-4 px-6 py-4 bg-[#192824] rounded-xl shadow-md text-white text-center border-2 border-white"></div>
          <!-- Loading Spinner -->
          <div id="loading-spinner" class="mt-6 hidden justify-center">
            <div class="animate-spin rounded-full h-10 w-10 border-t-4 border-white border-opacity-50"></div>
          </div>

          <div class="flex justify-center mt-4">
            <button onclick="resetAndBack()" class="bg-[#192824] hover:bg-[#0e3f2c] transition text-white px-6 py-2 rounded-xl shadow-md border-white border-2">
              üîÅ Reset & Kembali ke Awal
            </button>
          </div>

        </div>

        
      </form>

      <!-- Catatan -->
      <div class="fixed bottom-5 text-2xl left-1/2 -translate-x-1/2 flex text-center text-sm text-gray-200 blue">
        ‚ö†Ô∏è Hasil prediksi bukan diagnosis medis resmi. Konsultasikan dengan tenaga medis untuk validasi lebih lanjut.
      </div>      
    </main>

    <script>
      const formDataPage1 = JSON.parse(localStorage.getItem('formData')) || {};
      function collectFormDataPage2() {
        const formData = {};
        formData.q11 = document.querySelector('input[name="q11"]:checked')?.value || null;
        formData.q12 = document.querySelector('input[name="q12"]:checked')?.value || null;
        formData.q13 = document.querySelector('input[name="q13"]:checked')?.value || null;
        formData.q14 = document.querySelector('input[name="q14"]:checked')?.value || null;
        formData.q15 = document.querySelector('input[name="q15"]:checked')?.value || null;
        formData.q16 = document.querySelector('input[name="q16"]:checked')?.value || null;
        return formData;
      }

      async function sendDataToAPI() {
  const finalData = { ...formDataPage1, ...collectFormDataPage2() };

  const dataToSend = [
    finalData.q1, finalData.q2, finalData.q3, finalData.q4,
    finalData.q5, finalData.q6, finalData.q7, finalData.q8,
    finalData.q9, finalData.q10, finalData.q11, finalData.q12,
    finalData.q13, finalData.q14, finalData.q15, finalData.q16
  ];

  const numericData = dataToSend.map(value => parseInt(value, 10));
  console.log("Data yang dikirim ke API:", numericData);

  const spinner = document.getElementById('loading-spinner');
  const predictionElement = document.getElementById('prediction-result');
  spinner.classList.remove('hidden');
  predictionElement.innerHTML = ""; // Kosongkan sementara

  try {
    const response = await fetch('http://127.0.0.1:8000/predict/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(dataToSend)
    });

    const result = await response.json();
    console.log("Response from API:", result);
    displayPredictionResult(result);
  } catch (error) {
    console.error("Error sending data to API:", error);
    predictionElement.innerHTML = `<p class="text-red-500">‚ùå Terjadi kesalahan. Silakan coba lagi.</p>`;
  } finally {
    spinner.classList.add('hidden'); // Sembunyikan spinner apapun hasilnya
  }
}

      function displayPredictionResult(result) {
        const predictionElement = document.getElementById('prediction-result');
        predictionElement.classList.remove('hidden'); // Tampilkan kotak hasil
        predictionElement.innerHTML = `
          <p class="text-sm mb-2">üîç <strong>Hasil Anda :</strong></p>
          <p class="text-4xl font-bold mb-2">${result.prediction}</p>
          <p class="text-base">Anda memiliki kemungkinan <strong>${result.prediction}</strong> terkena TBC. Segera cari pertolongan medis!</p>
        `;
      }
      document.getElementById('predict-btn').addEventListener('click', sendDataToAPI);
    </script>
  </body>
</html>
